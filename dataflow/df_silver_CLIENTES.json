{
	"name": "df_silver_CLIENTES",
	"properties": {
		"folder": {
			"name": "SILVER"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_sql_BRONZE_CLIENTES",
						"type": "DatasetReference"
					},
					"name": "Clientes"
				},
				{
					"dataset": {
						"referenceName": "ds_sql_BRONZE_CLIENTES_LOCATION",
						"type": "DatasetReference"
					},
					"name": "ClientesLocation"
				},
				{
					"dataset": {
						"referenceName": "ds_sql_BRONZE_CLIENTES_DB_GEN",
						"type": "DatasetReference"
					},
					"name": "bronzeClientesGen"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_sql_silver_CLIENTES",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "limpiaCIDgeneraCSTKEY"
				},
				{
					"name": "DeCSTKEYgeneraCSTIDsoloConNumeros"
				},
				{
					"name": "limpiarCIDGenerarCSTKEY"
				},
				{
					"name": "creaCSTIDusandoCSTKEY"
				},
				{
					"name": "unionConLocation"
				},
				{
					"name": "unionConClientesGen"
				},
				{
					"name": "limpiezaFinal"
				},
				{
					"name": "eliminarNulos"
				},
				{
					"name": "QuitamosRenombranosColumnasDuplicadas"
				}
			],
			"scriptLines": [
				"source(output(",
				"          CST_ID as string,",
				"          CST_KEY as string,",
				"          CST_FIRSTNAME as string,",
				"          CST_LASTNAME as string,",
				"          CST_MARITAL_STATUS as string,",
				"          CST_GNRD as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> Clientes",
				"source(output(",
				"          CID as string,",
				"          CNTRY as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> ClientesLocation",
				"source(output(",
				"          CID as string,",
				"          BDATE as string,",
				"          GEN as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> bronzeClientesGen",
				"bronzeClientesGen derive(CST_KEY = iif(startsWith(CID, 'NAS'), substring(CID, 4, length(CID)), CID)) ~> limpiaCIDgeneraCSTKEY",
				"limpiaCIDgeneraCSTKEY derive(CST_ID = toInteger(regexReplace(CST_KEY, '[^0-9]', ''))) ~> DeCSTKEYgeneraCSTIDsoloConNumeros",
				"ClientesLocation derive(CST_KEY = replace(replace(CID, '-', ''), 'NAS', '')) ~> limpiarCIDGenerarCSTKEY",
				"limpiarCIDGenerarCSTKEY derive(CST_ID = toInteger(regexReplace(CST_KEY, '[^0-9]', ''))) ~> creaCSTIDusandoCSTKEY",
				"Clientes, creaCSTIDusandoCSTKEY join(Clientes@CST_KEY == limpiarCIDGenerarCSTKEY@CST_KEY,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> unionConLocation",
				"unionConLocation, DeCSTKEYgeneraCSTIDsoloConNumeros join(Clientes@CST_KEY == limpiaCIDgeneraCSTKEY@CST_KEY,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> unionConClientesGen",
				"unionConClientesGen derive(CST_FIRSTNAME = trim(replace(CST_FIRSTNAME,' ',' ')),",
				"          CST_LASTNAME = trim(replace(CST_LASTNAME,' ',' ')),",
				"          CST_MARITAL_STATUS = upper(trim(CST_MARITAL_STATUS)),",
				"          CST_GNRD = upper(trim(CST_GNRD)),",
				"          GEN = upper(trim(GEN)),",
				"          CNTRY = trim(CNTRY),",
				"          BDATE = toDate(BDATE,'yyyy-MM-dd')) ~> limpiezaFinal",
				"QuitamosRenombranosColumnasDuplicadas filter(!(isNull(CST_ID) || isNull(CST_KEY) || isNull(CST_FIRSTNAME))",
				") ~> eliminarNulos",
				"limpiezaFinal select(mapColumn(",
				"          CST_FIRSTNAME,",
				"          CST_LASTNAME,",
				"          CST_MARITAL_STATUS,",
				"          CST_GNRD,",
				"          CNTRY,",
				"          CST_KEY = limpiarCIDGenerarCSTKEY@CST_KEY,",
				"          BDATE,",
				"          GEN,",
				"          CST_ID = DeCSTKEYgeneraCSTIDsoloConNumeros@CST_ID",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> QuitamosRenombranosColumnasDuplicadas",
				"eliminarNulos sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          CST_ID as integer,",
				"          CST_KEY as string,",
				"          CST_FIRSTNAME as string,",
				"          CST_LASTNAME as string,",
				"          CST_MARITAL_STATUS as string,",
				"          CST_GNRD as string,",
				"          CNTRY as string,",
				"          BDATE as date,",
				"          GEN as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          CST_ID,",
				"          CST_KEY,",
				"          CST_FIRSTNAME,",
				"          CST_LASTNAME,",
				"          CST_MARITAL_STATUS,",
				"          CST_GNRD,",
				"          CNTRY,",
				"          BDATE,",
				"          GEN",
				"     )) ~> sink1"
			]
		}
	}
}